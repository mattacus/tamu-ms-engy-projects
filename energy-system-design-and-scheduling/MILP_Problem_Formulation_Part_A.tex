\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[margin=1in]{geometry}
\usepackage{booktabs} % For better table lines
\usepackage{caption}  % For table captions
\usepackage{float}    % Add this package for [H] placement
\usepackage{siunitx}  % For formatting units and numbers
\usepackage{enumitem} % For custom list formatting

\begin{document}

\title{ENGY 604 Project - MILP Formulation (Part A)}
\author{Team 3}
\date{}
\maketitle

% Sections 1, 2, and 3 are unchanged
\section*{1. Sets}
\begin{itemize}
    \item $R$: Set of Primary Resources, $r \in \{\text{Natural Gas, Biomass, Grid Electricity}\}$
    \item $G$: Set of Generators, $g \in \{\text{Biomass ST, NatGas CHP, Solar PV, Wind Farm}\}$
    \item $D$: Set of Conversion Devices, $d \in \{\text{Refrigerator, LED, Heater}\}$
\end{itemize}

\section*{2. Parameters (Base)}

\subsection*{General Parameters}
\begin{itemize}
    \item $H$: Operating horizon ($20$ years)
    \item $CF_1$: Conversion factor from kW-year to GJ ($\approx 31.54 \text{ GJ/kW-year}$)
    \item $CF_2$: Conversion factor from GJ to PJ ($10^{-6} \text{ PJ/GJ}$)
\end{itemize}

\subsection*{Resource Parameters}
\begin{itemize}
    \item $\text{Price}_r$: Price of resource $r$ (\$/GJ)
    \item ${\text{CO}_2}\text{Emis}_r$: $\text{CO}_2$ Emissions for resource $r$ (kg/PJ)
\end{itemize}

\subsection*{Generator Parameters}
\begin{itemize}
    \item $\text{capex}_g$: Capital cost for generator $g$ (\$/kW)
    \item $\text{opex}_g$: Operational cost for generator $g$ (\$/kW-year)
    \item $\eta_g^{\text{elec}}$: Electrical efficiency of generator $g$ (as fraction)
    \item $\eta_g^{\text{heat}}$: Heating efficiency of generator $g$ (as fraction)
    \item $C_g^{\text{min}}$: Minimum capacity of generator $g$ (kW)
    \item $C_g^{\text{max}}$: Maximum capacity of generator $g$ (kW)
\end{itemize}

\subsection*{Conversion Devices Parameters}
\begin{itemize}
    \item $\text{capex}_d$: Capital cost for conversion device $d$ (\$/kW)
    \item $\text{opex}_d$: Operational cost for conversion device $d$ (\$/kW-year)
    \item $\eta_d$: Efficiency of conversion device $d$ (as fraction, or COP)
    \item $\text{Demand}_d$: Demand for conversion device $d$ (kW)
\end{itemize}

\section*{3. Parameters (Intermediate)}
% \subsection*{Total Hours}
% The total number of hours over the horizon
% \begin{align*}
%     \text{Hours}_{\text{total}} & = H \times \text{(hours per year)}\text{ hours}
% \end{align*}

\subsection*{Total Electrical Demand (kW)}
This is the total power required by the electricity-driven conversion devices.
\begin{align*}
    \text{ElecDemand}_{\text{total}} & = \frac{\text{Demand}_{\text{refrig}}}{\eta_{\text{refrig}}} + \frac{\text{Demand}_{\text{led}}}{\eta_{\text{led}}}
\end{align*}

\subsection*{Total Heat Demand (kW)}
This is the total heat required by the heat-driven conversion devices.
\begin{align*}
    \text{HeatDemand}_{\text{total}} & = \frac{\text{Demand}_{\text{heater}}}{\eta_{\text{heater}}}
\end{align*}

\subsection*{Resource Prices (\$/kW-year)}
This converts the price from \$/GJ to \$/kW-year using $CF_1$.
\begin{align*}
    \text{Price}^{\text{kwyr}}_{\text{natgas}}  & = \text{Price}_{\text{natgas}} \cdot CF_1  \\
    \text{Price}^{\text{kwyr}}_{\text{biomass}} & = \text{Price}_{\text{biomass}} \cdot CF_1 \\
    \text{Price}^{\text{kwyr}}_{\text{grid}}    & = \text{Price}_{\text{grid}} \cdot CF_1
\end{align*}

\subsection*{Resource Emissions (kg/kW-year)}
This converts emissions from kg/PJ to kg/kW-year using $CF_1$ and $CF_2$.
\begin{align*}
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{natgas}}  & = {\text{CO}_2}\text{Emis}_{\text{natgas}} \cdot CF_1 \cdot CF_2  \\
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{biomass}} & = {\text{CO}_2}\text{Emis}_{\text{biomass}} \cdot CF_1 \cdot CF_2 \\
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{grid}}    & = {\text{CO}_2}\text{Emis}_{\text{grid}} \cdot CF_1 \cdot CF_2
\end{align*}

\subsection*{Fixed Converter Cost}
\textbf{Capacity for each converter}

From Table~\ref{tab:table1}, the required input capacities are:
\begin{align*}
    C^{\text{input}}_{\text{refrigerator}} & = \frac{\text{Demand}_{\text{refrigeration}}}{\eta_{\text{refrigerator}}} \\
    C^{\text{input}}_{\text{LED}}          & = \frac{\text{Demand}_{\text{lighting}}}{\eta_{\text{LED}}}               \\
    C^{\text{input}}_{\text{heater}}       & = \frac{\text{Demand}_{\text{heating}}}{\eta_{\text{heater}}}
\end{align*}

\textbf{Total fixed converter cost}

For capex we use the nameplate demand, and for opex we use the calculated capacity.
\begin{align*}
    Cost_{\text{conv}} & = \sum_{d \in D} \left( \text{Demand}_d \cdot \text{capex}_d + H \cdot C^{\text{input}}_d \cdot \text{opex}_d \right)
\end{align*}

\newpage

\section*{4. Mathematical Problem Formulation}

\subsection*{4.1 Decision Variables}
\begin{description}[style=multiline, leftmargin=3cm, font=\normalfont]
    \item[$C_g $]: Continuous variable for the capacity (size) built for each generator $g$ (kW).
    \item[$P_g^{\text{elec}} $]: Continuous variable for the actual electric power produced by generator $g$ (kW).
    \item[$P_r^{\text{cons}} $]: Continuous variable for the amount of primary resource $r$ consumed, in equivalent units of power (kW).
    \item[$y_g $]: Binary variable; $1$ if generator $g$ is built, $0$ otherwise.
\end{description}

\subsection*{4.2 Objective Functions}
\begin{description}[style=multiline, leftmargin=3cm, font=\normalfont]
    \item[Objective 1:] Minimize Total Cost ($Z_{\text{COST}}$)
          \begin{equation*}
              \min \underbrace{\sum_{g \in G} (C_g \cdot \text{capex}_g)}_{\text{Gen CAPEX}} + \underbrace{H \cdot \sum_{g \in G} (C_g \cdot \text{opex}_g)}_{\text{Gen OPEX (20 yr)}} + \underbrace{H \cdot \sum_{r \in R} (P_r^{\text{cons}} \cdot {\text{Price}^\text{kwyr}}_r)}_{\text{Resource Cost (20 yr)}} + \underbrace{Cost_{\text{conv}}}_{\text{Fixed Converter Cost}}
          \end{equation*}

    \item[Objective 2:] Minimize Total Emissions ($Z_{\text{EMIS}}$)
          \begin{equation*}
              \min H \cdot \sum_{r \in R} (P_r^{\text{cons}} \cdot {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{r}})
          \end{equation*}

    \item[Objective 3:] Maximize Efficiency (Minimize Primary Input, $Z_{\text{INPUT}}$)
          \begin{equation*}
              \min \sum_{r \in R} P_r^{\text{cons}}
          \end{equation*}
\end{description}

\subsection*{4.3 Constraints}
\smallskip
\noindent \textbf{Note:} Wind and solar have no resource costs, so they do not require a fuel balance equation.

\begin{description}[style=multiline, leftmargin=3cm, font=\normalfont]
    \item[C1:] Electricity Balance
          \begin{equation*}
              \sum_{g \in G} P_g^{\text{elec}} + P_{\text{Grid}}^{\text{cons}} = \text{ElecDemand}_{\text{total}}
          \end{equation*}

    \item[C2:] Heat Balance
          \begin{equation*}
              P_{\text{CHP}}^{\text{elec}} \cdot \frac{\eta_{\text{CHP}}^{\text{heat}}}{\eta_{\text{CHP}}^{\text{elec}}} = \text{HeatDemand}_{\text{total}} \quad \text{(since } P_{\text{CHP}}^{\text{heat}} = P_{\text{CHP}}^{\text{elec}} \cdot \frac{\eta_{\text{CHP}}^{\text{heat}}}{\eta_{\text{CHP}}^{\text{elec}}} \text{)}
          \end{equation*}

    \item[C3:] Fuel Balance (Biomass)
          \begin{equation*}
              P_{\text{BioST}}^{\text{elec}} = P_{\text{Biomass}}^{\text{cons}} \cdot \eta_{\text{BioST}}^{\text{elec}}
          \end{equation*}

    \item[C4:] Fuel Balance (Natural Gas)
          \begin{equation*}
              P_{\text{CHP}}^{\text{elec}} = P_{\text{Natural Gas}}^{\text{cons}} \cdot \eta_{\text{CHP}}^{\text{elec}}
          \end{equation*}

    \item[C5:] Generation Output Limit
          \begin{equation*}
              P_g^{\text{elec}} \le C_g \quad \forall g \in G
          \end{equation*}

    \item[C6:] Capacity Limits (Min/Max)
          \begin{equation*}
              y_g \cdot C_g^{\text{min}} \le C_g \le y_g \cdot C_g^{\text{max}} \quad \forall g \in G
          \end{equation*}

    \item[C7:] Integer Cut
          \begin{equation*}
              \sum_{g \in G} y_g \le 1
          \end{equation*}

    \item[C8:] Non-Negativity \& Binary
          \begin{align*}
              C_g, P_g^{\text{elec}}, P_r^{\text{cons}} & \ge 0        \\
              y_g                                       & \in \{0, 1\}
          \end{align*}
\end{description}

\newpage
\appendix
\section*{Appendix A: Parameter Value Tables}

\begin{table}[H]
    \centering
    \caption{Technical and economic parameters of on-site energy conversion technologies}
    \label{tab:table1}
    \begin{tabular}{@{}lccc@{}}
        \toprule
        Sources                      & Refrigerator  & LED         & Heater        \\ \midrule
        Input Resource               & Electricity   & Electricity & Heat          \\
        Output Resource              & Refrigeration & Lighting    & Space Heating \\
        $\eta_d$ [\%]                & 300 (COP)     & 80          & 85            \\
        $\text{capex}_d$ [\$/kW]     & 70            & 10          & 30            \\
        $\text{opex}_d$ [\$/kW-year] & 4             & 1           & 3             \\ \bottomrule
    \end{tabular}
\end{table}

\begin{table}[H]
    \centering
    \caption{Technical and economic parameters of energy generation technologies}
    \label{tab:table2}
    \begin{tabular}{@{}lcccc@{}}
        \toprule
        Processes                    & BioST             & CHP                 & PV          & Wind        \\ \midrule
        Input Resource               & Biomass           & Natural Gas         & Solar       & Wind        \\
        Output Resource              & Electricity       & Electricity \& Heat & Electricity & Electricity \\
        $\eta_g^{\text{elec}}$ [\%]  & 68                & 44                  & 9           & 22          \\
        $\eta_g^{\text{heat}}$ [\%]  & 0                 & 28                  & 0           & 0           \\
        $C_g^{\text{min}}$ [kW]      & 100               & 800                 & 10          & 10          \\
        $C_g^{\text{max}}$ [kW]      & $1 \times 10^{6}$ & $1 \times 10^{6}$   & 300         & 500         \\
        $\text{capex}_g$ [\$/kW]     & 250               & 500                 & 2000        & 2000        \\
        $\text{opex}_g$ [\$/kW year] & 15                & 15                  & 500         & 1200        \\ \bottomrule
    \end{tabular}
\end{table}

\begin{table}[H]
    \centering
    \caption{Prices and CO2 emissions of the primary energy resources and grid electricity}
    \label{tab:table3}
    \begin{tabular}{@{}lccc@{}}
        \toprule
        Sources                              & Natural Gas & Biomass & Grid Electricity \\ \midrule
        $\text{Price}_r$ [\$/GJ]             & 8.89        & 9.72    & 36.11            \\
        ${\text{CO}_2}\text{Emis}_r$ [kg/PJ] & 56          & 100     & 90               \\ \bottomrule
    \end{tabular}
\end{table}

\begin{table}[H]
    \centering
    \caption{Energy demands for various utilities}
    \label{tab:table4}
    \begin{tabular}{@{}lccc@{}}
        \toprule
        Uses                   & Lighting & Refrigeration & Space Heating \\ \midrule
        $\text{Demand}_d$ [kW] & 200      & 1000          & 100           \\ \bottomrule
    \end{tabular}
\end{table}

\newpage
\section*{Appendix B: Intermediate Parameter Calculations}

\noindent These are the full worked out conversions for the intermediate parameters.

% \subsection*{Total Hours}
% The total number of hours over the horizon
% \begin{align*}
%     \text{Hours}_{\text{total}} & = H \times 8760 = 20 \times 8760 = 175,200
% \end{align*}

\subsection*{Total Electrical Demand (kW)}
This is the total power required by the electricity-driven conversion devices.
\begin{align*}
    \text{ElecDemand}_{\text{total}} & = \frac{\text{Demand}_{\text{refrig}}}{\eta_{\text{refrig}}} + \frac{\text{Demand}_{\text{led}}}{\eta_{\text{led}}} \\
                                     & = \frac{1000 \text{ kW}}{3.0} + \frac{200 \text{ kW}}{0.80}                                                         \\
                                     & = 333.33 \text{ kW} + 250 \text{ kW}                                                                                \\
                                     & = 583.33 \text{ kW}
\end{align*}

\subsection*{Total Heat Demand (kW)}
This is the total heat required by the heat-driven conversion devices.
\begin{align*}
    \text{HeatDemand}_{\text{total}} & = \frac{\text{Demand}_{\text{heater}}}{\eta_{\text{heater}}} \\
                                     & = \frac{100 \text{ kW}}{0.85}                                \\
                                     & = 117.65 \text{ kW}
\end{align*}

\subsection*{Resource Prices (\$/kW-year)}
This converts the price from \$/GJ to \$/kW-year using $CF_1$.
\begin{align*}
    \text{Price}^{\text{kwyr}}_{\text{natgas}}  & = \text{Price}_{\text{natgas}} \cdot CF_1 = 8.89 \cdot 31.54 \approx 280.39 \text{ \$/kW-year}  \\
    \text{Price}^{\text{kwyr}}_{\text{biomass}} & = \text{Price}_{\text{biomass}} \cdot CF_1 = 9.72 \cdot 31.54 \approx 306.57 \text{ \$/kW-year} \\
    \text{Price}^{\text{kwyr}}_{\text{grid}}    & = \text{Price}_{\text{grid}} \cdot CF_1 = 36.11 \cdot 31.54 \approx 1138.80 \text{ \$/kW-year}
\end{align*}

\subsection*{Resource Emissions (kg/kW-year)}
This converts emissions from kg/PJ to kg/kW-year using $CF_1$ and $CF_2$.
\begin{align*}
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{natgas}}  & = {\text{CO}_2}\text{Emis}_{\text{natgas}} \cdot CF_1 \cdot CF_2 = 56 \cdot 31.54 \cdot 10^{-9} \approx 1.766 \times 10^{-6} \text{ kg/kW-year}   \\
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{biomass}} & = {\text{CO}_2}\text{Emis}_{\text{biomass}} \cdot CF_1 \cdot CF_2 = 100 \cdot 31.54 \cdot 10^{-9} \approx 3.154 \times 10^{-6} \text{ kg/kW-year} \\
    {\text{CO}_2}\text{Emis}^{\text{kwyr}}_{\text{grid}}    & = {\text{CO}_2}\text{Emis}_{\text{grid}} \cdot CF_1 \cdot CF_2 = 90 \cdot 31.54 \cdot 10^{-9} \approx 2.839 \times 10^{-6} \text{ kg/kW-year}
\end{align*}

\subsection*{Fixed Converter Cost}
\textbf{Capacity for each converter}

From Table~\ref{tab:table1}, the required input capacities are:
\begin{align*}
    C^{\text{input}}_{\text{refrigerator}} & = \frac{\text{Demand}_{\text{refrigeration}}}{\eta_{\text{refrigerator}}} = \frac{1000 \text{ kW}}{3.0} = 333.33 \text{ kW} \\
    C^{\text{input}}_{\text{LED}}          & = \frac{\text{Demand}_{\text{lighting}}}{\eta_{\text{LED}}} = \frac{200 \text{ kW}}{0.80} = 250 \text{ kW}                  \\
    C^{\text{input}}_{\text{heater}}       & = \frac{\text{Demand}_{\text{heating}}}{\eta_{\text{heater}}} = \frac{100 \text{ kW}}{0.85} = 117.65 \text{ kW}
\end{align*}

\textbf{Total fixed converter cost}

\begin{align*}
    Cost_{\text{conv}} & = \sum_{d \in D} \left( \text{Demand}_d \cdot \text{capex}_d + H \cdot C^{\text{input}}_d \cdot \text{opex}_d \right)                                \\
                       & = \text{Demand}_{\text{refrigeration}}\cdot\text{capex}_{\text{refrigerator}} + H\cdot C_{\text{refrigerator}}\cdot\text{opex}_{\text{refrigerator}} \\
                       & \quad + \text{Demand}_{\text{lighting}}\cdot\text{capex}_{\text{LED}} + H\cdot C_{\text{LED}}\cdot\text{opex}_{\text{LED}}                           \\
                       & \quad + \text{Demand}_{\text{heating}}\cdot\text{capex}_{\text{heater}} + H\cdot C_{\text{heater}}\cdot\text{opex}_{\text{heater}}                   \\
                       & = \$70{,}000 + \$26{,}666.40 + \$2{,}000 + \$5{,}000 + \$3{,}000 + \$7{,}059.00                                                                      \\
                       & = \$113{,}725.40 \text{ (total fixed conversion cost over 20 years)}
\end{align*}

\end{document}
